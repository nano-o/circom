<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/Mirabelle/mirabelle_sledgehammer.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/Mirabelle/mirabelle_sledgehammer.ML›</h1>
</div>

<pre class="source"><span class="comment1"><span>(*  Title:      HOL/Tools/Mirabelle/mirabelle_sledgehammer.ML
    Author:     Jasmin Blanchette, TU Munich
    Author:     Sascha Boehme, TU Munich
    Author:     Tobias Nipkow, TU Munich
    Author:     Makarius
    Author:     Martin Desharnais, UniBw Munich, MPI-INF Saarbruecken

Mirabelle action: "sledgehammer".
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Mirabelle_Sledgehammer</span></span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MIRABELLE_ACTION</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(*To facilitate synching the description of Mirabelle Sledgehammer parameters
 (in ../lib/Tools/mirabelle) with the parameters actually used by this
 interface, the former extracts PARAMETER and DESCRIPTION from code below which
 has this pattern (provided it appears in a single line):
   val .*K = "PARAMETER" (*DESCRIPTION*)
*)</span></span><span>
</span><span class="comment1"><span>(* NOTE: Do not forget to update the Sledgehammer documentation to reflect changes here. *)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>check_trivialK</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"check_trivial"</span></span><span> </span><span class="comment1"><span>(*=BOOL: check if goals are "trivial"*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exhaustive_preplayK</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"exhaustive_preplay"</span></span><span> </span><span class="comment1"><span>(*=BOOL: show exhaustive preplay data*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep_probsK</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"keep_probs"</span></span><span> </span><span class="comment1"><span>(*=BOOL: keep temporary problem files created by sledgehammer*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep_proofsK</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"keep_proofs"</span></span><span> </span><span class="comment1"><span>(*=BOOL: keep temporary proof files created by ATPs*)</span></span><span>

</span><span class="comment1"><span>(*defaults used in this Mirabelle action*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>check_trivial_default</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exhaustive_preplay_default</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep_probs_default</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep_proofs_default</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>sh_data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ShData</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>{</span></span><span>
  calls</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  success</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  nontriv_calls</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  nontriv_success</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  lemmas</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  max_lems</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  time_isa</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>,</span></span><span>
  time_prover</span><span class="main"><span>:</span></span><span> int</span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_sh_data</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span>
       </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>ShData</span></span><span class="main"><span>{</span></span><span>calls</span><span class="main"><span>=</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> success</span><span class="main"><span>=</span></span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> nontriv_calls</span><span class="main"><span>=</span></span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span>
         nontriv_success</span><span class="main"><span>=</span></span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> lemmas</span><span class="main"><span>=</span></span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> max_lems</span><span class="main"><span>=</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span>
         time_isa</span><span class="main"><span>=</span></span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> time_prover</span><span class="main"><span>=</span></span><span class="entity"><span>time_prover</span></span><span class="main"><span>}</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty_sh_data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_sh_data</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>tuple_of_sh_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ShData</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>sh</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>make_sh_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tuple_of_sh_data</span></span><span> </span><span class="entity"><span>sh</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inc_sh_calls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inc_sh_success</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inc_sh_nontriv_calls</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inc_sh_nontriv_success</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inc_sh_lemmas</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span>+</span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inc_sh_max_lems</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inc_sh_time_isa</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>inc_sh_time_prover</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_sh_data</span></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_prover</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string_of_int</span><span> </span><span>o</span><span> </span><span>the_default</span><span> </span><span class="inner_numeral"><span>0</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string_of_int</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>str3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Real.fmt</span><span> </span><span class="main"><span>(</span></span><span>StringCvt.FIX</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_numeral"><span>3</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>percentage</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span> </span><span>*</span><span> </span><span class="inner_numeral"><span>100</span></span><span> </span><span>div</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Real.fromInt</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>/</span><span> </span><span class="inner_numeral"><span>1000.0</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>avg_time</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span>Real.fromInt</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>/</span><span> </span><span class="inner_numeral"><span>1000.0</span></span><span class="main"><span>)</span></span><span> </span><span>/</span><span> </span><span>Real.fromInt</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>0.0</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>log_sh_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ShData</span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lemmas</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>max_lems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>time_prover</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="inner_quoted"><span>"\nTotal number of sledgehammer calls: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>calls</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nNumber of successful sledgehammer calls: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>success</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nNumber of sledgehammer lemmas: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>lemmas</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nMax number of sledgehammer lemmas: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>max_lems</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nSuccess rate: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>percentage</span></span><span> </span><span class="entity"><span>success</span></span><span> </span><span class="entity"><span>calls</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"%"</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nTotal number of nontrivial sledgehammer calls: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>nontriv_calls</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nNumber of successful nontrivial sledgehammer calls: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="entity"><span>nontriv_success</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nTotal time for sledgehammer calls (Isabelle): "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>time_isa</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nTotal time for successful sledgehammer calls (ATP): "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>str3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ms</span></span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nAverage time for sledgehammer calls (Isabelle): "</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>str3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>avg_time</span></span><span> </span><span class="entity"><span>time_isa</span></span><span> </span><span class="entity"><span>calls</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
  </span><span class="inner_quoted"><span>"\nAverage time for successful sledgehammer calls (ATP): "</span></span><span> </span><span>^</span><span>
    </span><span class="entity"><span>str3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>avg_time</span></span><span> </span><span class="entity"><span>time_prover</span></span><span> </span><span class="entity"><span>success</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>log_data</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sh</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="entity"><span>ShData</span></span><span> </span><span class="main"><span>{</span></span><span>calls</span><span class="main"><span>=</span></span><span class="entity"><span>sh_calls</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>sh_calls</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
    </span><span class="entity"><span>log_sh_data</span></span><span> </span><span class="entity"><span>sh</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="inner_quoted"><span>""</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run_sh</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>state</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">try</span><span class="hidden">&gt;</span></span></span><span class="entity"><span>‹
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>set_file_name</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dir</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>keep_probs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>keep_proofs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>filename</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"prob_"</span></span><span> </span><span>^</span><span>
              </span><span>StringCvt.padLeft</span><span> </span><span class="inner_quoted"><span>#"0"</span></span><span> </span><span class="inner_numeral"><span>5</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str0</span></span><span> </span><span class="main"><span>(</span></span><span>Position.line_of</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span>
              </span><span>StringCvt.padLeft</span><span> </span><span class="inner_quoted"><span>#"0"</span></span><span> </span><span class="inner_numeral"><span>6</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>str0</span></span><span> </span><span class="main"><span>(</span></span><span>Position.offset_of</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>Config.put</span><span> </span><span class="entity"><span>Sledgehammer_Prover_ATP.atp_problem_prefix</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>filename</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"__"</span></span><span class="main"><span>)</span></span><span>
            </span><span>#&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>keep_probs</span></span><span> </span><span>?</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Sledgehammer_Prover_ATP.atp_problem_dest_dir</span></span><span> </span><span class="entity"><span>dir</span></span><span class="main"><span>)</span></span><span>
            </span><span>#&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>keep_proofs</span></span><span> </span><span>?</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Sledgehammer_Prover_ATP.atp_proof_dest_dir</span></span><span> </span><span class="entity"><span>dir</span></span><span class="main"><span>)</span></span><span>
            </span><span>#&gt;</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>SMT_Config.debug_files</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dir</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"/"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>filename</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"__"</span></span><span> </span><span>^</span><span> </span><span>serial_string</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>set_file_name</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span>I</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>state'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>state</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>Proof.map_context</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_file_name</span></span><span> </span><span class="entity"><span>keep</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sledgehammer_outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cpu_time</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Mirabelle.cpu_time</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>Sledgehammer.run_sledgehammer</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>Sledgehammer_Prover.Normal</span></span><span> </span><span>NONE</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
          </span><span class="entity"><span>Sledgehammer_Fact.no_fact_override</span></span><span> </span><span class="entity"><span>state'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>sledgehammer_outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cpu_time</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword3"><span class="entity"><span class="entity"><span>catch</span></span></span></span><span> </span><span>ERROR</span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sledgehammer.SH_Unknown</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>" error: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sledgehammer.SH_Unknown</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>" error: unexpected error"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
  ›</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run_sledgehammer</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>provers</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>output_dir</span></span><span> </span><span class="entity"><span>keep_probs</span></span><span> </span><span class="entity"><span>keep_proofs</span></span><span>
    </span><span class="entity"><span>exhaustive_preplay</span></span><span> </span><span class="entity"><span>thy_index</span></span><span> </span><span class="entity"><span>trivial</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>triv_str</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>trivial</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"[T] "</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>keep_probs</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>keep_proofs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy_long_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.theory_long_name</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.theory_of</span></span><span> </span><span class="entity"><span>st</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>session_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Long_Name.qualifier</span><span> </span><span class="entity"><span>thy_long_name</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Long_Name.base_name</span><span> </span><span class="entity"><span>thy_long_name</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subdir</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>StringCvt.padLeft</span><span> </span><span class="inner_quoted"><span>#"0"</span></span><span> </span><span class="inner_numeral"><span>4</span></span><span> </span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>thy_index</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>thy_name</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span>Path.append</span><span> </span><span class="main"><span>(</span></span><span>Path.append</span><span> </span><span class="entity"><span>output_dir</span></span><span> </span><span class="main"><span>(</span></span><span>Path.basic</span><span> </span><span class="entity"><span>session_name</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Path.basic</span><span> </span><span class="entity"><span>subdir</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>Isabelle_System.make_directory</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Path.implode</span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>dir</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dir</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>keep_probs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>keep_proofs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span>NONE</span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>provers</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sledgehamer_outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cpu_time</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>run_sh</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>keep</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>st</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>time_prover</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>change_data</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaustive_preplay_msg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>sledgehamer_outcome</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span class="entity"><span>Sledgehammer.SH_Some</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>used_facts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>run_time</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>preplay_results</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_used_facts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>used_facts</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>time_prover</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Time.toMilliseconds</span><span> </span><span class="entity"><span>run_time</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>change_data</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>inc_sh_success</span></span><span>
            </span><span>#&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>trivial</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>inc_sh_nontriv_success</span></span><span>
            </span><span>#&gt;</span><span> </span><span class="entity"><span>inc_sh_lemmas</span></span><span> </span><span class="entity"><span>num_used_facts</span></span><span>
            </span><span>#&gt;</span><span> </span><span class="entity"><span>inc_sh_max_lems</span></span><span> </span><span class="entity"><span>num_used_facts</span></span><span>
            </span><span>#&gt;</span><span> </span><span class="entity"><span>inc_sh_time_prover</span></span><span> </span><span class="entity"><span>time_prover</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exhaustive_preplay_msg</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>exhaustive_preplay</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="entity"><span>preplay_results</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map</span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>meth</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>play_outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="inner_quoted"><span>"Preplay: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>Sledgehammer_Proof_Methods.string_of_proof_method</span></span><span>
                      </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ATP_Util.content_of_pretty</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>used_facts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>meth</span></span><span> </span><span>^</span><span>
                    </span><span class="inner_quoted"><span>" ("</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>Sledgehammer_Proof_Methods.string_of_play_outcome</span></span><span> </span><span class="entity"><span>play_outcome</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>")"</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>cat_lines</span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span class="inner_quoted"><span>""</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>time_prover</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>change_data</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaustive_preplay_msg</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>I</span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>outcome_msg</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="inner_quoted"><span>"(SH "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>cpu_time</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"ms"</span></span><span> </span><span>^</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>time_prover</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>", ATP "</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>ms</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"ms"</span></span><span class="main"><span>)</span></span><span> </span><span>^</span><span>
      </span><span class="inner_quoted"><span>") ["</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>prover_name</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"]: "</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>sledgehamer_outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>triv_str</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>outcome_msg</span></span><span> </span><span>^</span><span> </span><span>Protocol_Message.clean_output</span><span> </span><span class="entity"><span>msg</span></span><span> </span><span>^</span><span>
       </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>exhaustive_preplay_msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>exhaustive_preplay_msg</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
     </span><span class="entity"><span>change_data</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>inc_sh_time_isa</span></span><span> </span><span class="entity"><span>cpu_time</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>try0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>not</span><span> </span><span>o</span><span> </span><span>null</span><span> </span><span>o</span><span> </span><span class="entity"><span>Try0.try0</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Time.fromSeconds</span><span> </span><span class="inner_numeral"><span>5</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>make_action</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>arguments</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>timeout</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>output_dir</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Mirabelle.action_context</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* Parse Mirabelle-specific parameters *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>check_trivial</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Mirabelle.get_bool_argument</span></span><span> </span><span class="entity"><span>arguments</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>check_trivialK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>check_trivial_default</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep_probs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Mirabelle.get_bool_argument</span></span><span> </span><span class="entity"><span>arguments</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>keep_probsK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>keep_probs_default</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>keep_proofs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Mirabelle.get_bool_argument</span></span><span> </span><span class="entity"><span>arguments</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>keep_proofsK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>keep_proofs_default</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exhaustive_preplay</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>Mirabelle.get_bool_argument</span></span><span> </span><span class="entity"><span>arguments</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exhaustive_preplayK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaustive_preplay_default</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Sledgehammer_Commands.default_params</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span><span class="hidden">\&lt;^</span><span class="control">theory</span><span class="hidden">&gt;</span></span></span></span></span><span> </span><span class="entity"><span>arguments</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Synchronized.var</span><span> </span><span class="inner_quoted"><span>"Mirabelle_Sledgehammer.data"</span></span><span> </span><span class="entity"><span>empty_sh_data</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>init_msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"Params for sledgehammer: "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>Sledgehammer_Prover.string_of_params</span></span><span> </span><span class="entity"><span>params</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>run</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="entity"><span>theory_index</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Mirabelle.command</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.major_prem_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>goal </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.goal</span></span><span> </span><span class="entity"><span>pre</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>can</span><span> </span><span>Logic.dest_conjunction</span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>can</span><span> </span><span>Logic.dest_equals</span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
          </span><span class="inner_quoted"><span>""</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>trivial</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>check_trivial</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>try0</span></span><span> </span><span class="entity"><span>pre</span></span><span> </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Timeout.TIMEOUT</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>outcome</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>log</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>change_data</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>run_sledgehammer</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>output_dir</span></span><span> </span><span class="entity"><span>keep_probs</span></span><span> </span><span class="entity"><span>keep_proofs</span></span><span> </span><span class="entity"><span>exhaustive_preplay</span></span><span>
                </span><span class="entity"><span>theory_index</span></span><span> </span><span class="entity"><span>trivial</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>pre</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Synchronized.change</span><span> </span><span class="entity"><span>data</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>change_data</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>inc_sh_calls</span></span><span> </span><span>#&gt;</span><span> </span><span>not</span><span> </span><span class="entity"><span>trivial</span></span><span> </span><span>?</span><span> </span><span class="entity"><span>inc_sh_nontriv_calls</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>log</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Symbol.trim_blanks</span><span>
            </span><span>|&gt;</span><span> </span><span>prefix_lines</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Sledgehammer.short_string_of_sledgehammer_outcome</span></span><span> </span><span class="entity"><span>outcome</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>finalize</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>log_data</span></span><span> </span><span class="main"><span>(</span></span><span>Synchronized.value</span><span> </span><span class="entity"><span>data</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>init_msg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>{</span></span><span>run </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>run</span></span><span class="main"><span>,</span></span><span> finalize </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>finalize</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Mirabelle.register_action</span></span><span> </span><span class="inner_quoted"><span>"sledgehammer"</span></span><span> </span><span class="entity"><span>make_action</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>